{% extends "base.html" %}
{% block title %}Change Password{% endblock %}

{% block content %}
<div class="max-w-md mx-auto p-4 text-copy">
  <h1 class="text-2xl font-bold mb-4">Change Password</h1>

  <form method="POST" class="bg-foreground border border-border rounded-xl p-4 space-y-3" id="pw-form">
    <div>
      <label for="current_password" class="block text-sm text-copy-lighter mb-1">Current password</label>
      <input id="current_password" name="current_password" type="password" required
        class="w-full rounded border border-border bg-foreground text-copy px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/40">
    </div>

    <div>
      <label for="new_password" class="block text-sm text-copy-lighter mb-1">New password</label>
      <input id="new_password" name="new_password" type="password" required
        class="w-full rounded border border-border bg-foreground text-copy px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/40">
    </div>

    <div>
      <label for="confirm_password" class="block text-sm text-copy-lighter mb-1">Confirm new password</label>
      <input id="confirm_password" name="confirm_password" type="password" required
        class="w-full rounded border border-border bg-foreground text-copy px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/40">
      <!-- live status message -->
      <p id="pw-match-msg" class="text-xs mt-1 hidden" aria-live="polite"></p>
    </div>

    <div class="pt-2 flex gap-2">
      <button id="pw-submit" type="submit" disabled
        class="inline-flex items-center justify-center rounded-lg bg-primary text-primary-content px-4 py-2 text-sm font-semibold opacity-60 cursor-not-allowed">
        Update password
      </button>
      <a href="{{ url_for('users.profile') }}"
        class="inline-flex items-center justify-center rounded-lg border border-border bg-background hover:bg-foreground px-4 py-2 text-sm">
        Cancel
      </a>
    </div>
  </form>

  <script>
    (function () {
      const newPw = document.getElementById('new_password');
      const confPw = document.getElementById('confirm_password');
      const submit = document.getElementById('pw-submit');
      const msg = document.getElementById('pw-match-msg');

      function setState(ok) {
        // base classes for the confirm input
        const base = "w-full rounded border bg-foreground text-copy px-3 py-2 focus:outline-none focus:ring-2";
        if (confPw.value.length === 0) {
          confPw.className = base + " border-border focus:ring-primary/40";
          msg.classList.add('hidden');
          submit.disabled = true;
          submit.classList.add('opacity-60', 'cursor-not-allowed');
          return;
        }
        msg.classList.remove('hidden');
        if (ok) {
          confPw.className = base + " border-green-500 focus:ring-green-500/40";
          msg.textContent = "Passwords match";
          msg.className = "text-xs mt-1 text-green-600";
          submit.disabled = false;
          submit.classList.remove('opacity-60', 'cursor-not-allowed');
        } else {
          confPw.className = base + " border-red-500 focus:ring-red-500/40";
          msg.textContent = "Passwords do not match";
          msg.className = "text-xs mt-1 text-red-600";
          submit.disabled = true;
          submit.classList.add('opacity-60', 'cursor-not-allowed');
        }
      }

      function check() {
        const ok = newPw.value.length > 0 && newPw.value === confPw.value;
        setState(ok);
      }

      newPw.addEventListener('input', check);
      confPw.addEventListener('input', check);
    })();
  </script>
</div>
{% endblock %}